#SENSOR INPUTS for dog automation. Includes push notification handlers.
- id: dog_food_tub_sensor
  alias: 'Dog: Fed Automated'
  trigger:
  - platform: event
    event_type: button_pressed
    event_data: {"state": "on", "entity_id": "switch.dog_food_container_sensor"}
  - platform: event
    event_type: html5_notification.clicked
    event_data:
      action: dog_fed
  action:
  - service: notify.push_main
    data_template:
      title: 'Dog has been fed!'
      message: 'Fed at {{  as_timestamp( now() ) | timestamp_custom("%I:%M%p") }}.'
      data:
        tag: 'dog_fed_notification'
  - service: input_boolean.turn_on
    data:
      entity_id: input_boolean.dog_fed

- id: dog_back_door_sensor
  alias: 'Dog: Let Out Automated'
  trigger:
  - platform: event
    event_type: button_pressed
    event_data: {"state": "on", "entity_id": "switch.back_door_sensor"}
  - platform: event
    event_type: html5_notification.clicked
    event_data:
      action: dog_let_out
  action:
  - service: notify.push_main
    data_template:
      title: 'Dog let out'
      message: 'Let out at {{  as_timestamp( now() ) | timestamp_custom("%I:%M%p") }}.'
      data:
        tag: 'dog_let_out_notification'
  - service: input_boolean.turn_on
    data:
      entity_id: input_boolean.dog_let_out

#automations
#Reset at midnight and noon.
- id: dog_reset_status
  alias: 'Dog: Reset status'
  trigger:
  - platform: time
    at: '00:00:00'
  - platform: time
    at: '12:00:00'
  action:
  - service: input_boolean.turn_off
    data:
      entity_id: input_boolean.dog_fed
  - service: input_boolean.turn_off
    data:
      entity_id: input_boolean.dog_let_out

- id: dog_check_let_out_workday
  alias: 'Dog: Check let out status on workday'
  trigger:
  - platform: time
    at: '08:00:00'
  - platform: time
    at: '22:00:00'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.dog_let_out
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
  action:
  - service: notify.push_main
    data:
      title: Let the Dog Out
      message: "The dog hasn't yet been let out!"
      data:
        tag: dog_let_out_notification
        actions:
        - action: dog_let_out
          title: "Let Out"

- id: dog_check_let_out_nonworkday
  alias: 'Dog: Check let out status on non-workday'
  trigger:
  - platform: time
    at: '09:00:00'
  - platform: time
    at: '22:30:00'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.dog_let_out
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'off'
  action:
  - service: notify.push_main
    data:
      title: Let the Dog Out
      message: "The dog hasn't yet been let out!"
      data:
        tag: dog_let_out_notification
        actions:
        - action: dog_let_out
          title: "Let Out"

- id: dog_check_fed_workday
  alias: 'Dog: Check fed status on workday'
  trigger:
  - platform: time
    at: '08:00:00'
  - platform: time
    at: '22:00:00'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.dog_fed
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
  action:
  - service: notify.push_main
    data:
      title: Feed the Dog
      message: "The dog hasn't yet been fed!"
      data:
        tag: dog_fed_notification
        actions:
        - action: dog_fed
          title: "Fed"

- id: dog_check_fed_nonworkday
  alias: 'Dog: Check fed status on non-workday'
  trigger:
  - platform: time
    at: '09:00:00'
  - platform: time
    at: '22:30:00'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.dog_fed
      state: 'off'
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'off'
  action:
  - service: notify.push_main
    data:
      title: Feed the Dog
      message: "The dog hasn't yet been fed!"
      data:
        tag: dog_fed_notification
        actions:
        - action: dog_fed
          title: "Fed"
